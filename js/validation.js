import{setFormSuccess,setModal}from"./utils.js";import{REGEX,inputsOptions}from"./const.js";function initValidation({form:t,inputsElements:e,textElements:n,button:i}){let r=isEnableButton(e);e.forEach((t=>{const e=findInputOption(t),r=findTextElement(t,n);"text"===getTypeInput(t.type)?t.addEventListener("input",(()=>onElementInput(t,e,r,i))):t.addEventListener("change",(()=>onElementChange(t,e,r,i)))})),i.addEventListener("enable-button",(()=>{r=isEnableButton(e)})),t.addEventListener("submit",(t=>onFormSubmit(t,r,e,n)))}function isEnableButton(t){return inputsOptions.every((e=>isValidInput(t,e)))}function isValidInput(t,e){const{required:n,max:i,pattern:r}=e,o=findInputValue(t,e);return"text"===getTypeInput(findInputType(t,e))?r.string.test(o)&&(o.length<=i||null===i)&&!1===REGEX.test(o)&&(""!==o&&!1===n||!0===n)||""===o&&!1===n:!1===n||!0===n&&!0===o}function findInputValue(t,e){let n=!1;return t.forEach((t=>{"text"===getTypeInput(t.type)?e.id===t.id&&(n=t.value):e.name===t.name&&!0===t.checked&&(n=t.checked)})),n}function findInputType(t,e){let n="";return t.forEach((t=>{"text"===getTypeInput(t.type)?e.id===t.id&&(n=t.type):e.name===t.name&&(n=t.type)})),n}function findTextElement(t,e){let n=null;return e.forEach((e=>{"text"===getTypeInput(t.type)?`${t.id}-error`===e.id&&(n=e):`${t.name}-error`===e.id&&(n=e)})),n}function findInputOption(t){return"text"===getTypeInput(t.type)?inputsOptions.find((({id:e})=>t.id===e)):inputsOptions.find((({name:e})=>t.name===e))}function setValidInputField(t,e,n){let i="",r=!0;const o=t.value,{required:u,max:l,pattern:s}=e;""===o&&!0===e.required?(i="Поле обязательное для заполнения",r=!1):o.length>l&&null!==l?(i=`Количество символов должно быть не больше ${l}`,r=!1):null!==s&&!1===s.string.test(o)&&(""!==o&&!1===u||!0===u)?(i=s.name,r=!1):REGEX.test(o)&&(i="Запрещены одни пробелы",r=!1),null!==n&&(!0===r?(t.classList.remove("form__input-text--error"),n?.classList.remove("form__error-text--active")):(t.classList.add("form__input-text--error"),n?.classList.add("form__error-text--active")),n.innerText=i)}function setValidToggleField(t,e,n){const i=document.querySelectorAll(`input:checked[name="${t.name}"]`),{required:r}=e;let o="",u=!0;0===i.length&&!0===r&&(o="Должно быть выбрано",u=!1),null!==n&&(!0===u?n?.classList.remove("form__error-toggle--active"):n?.classList.add("form__error-toggle--active"),n.innerText=o)}function getTypeInput(t){switch(t){case"text":case"email":case"textarea":case"tel":return"text";case"radio":case"checkbox":return"toggle"}}function onFormSubmit(t,e,n,i){t.preventDefault(),!0===e?setFormSuccess():n.forEach((t=>{const e=findInputOption(t),n=findTextElement(t,i);"text"===getTypeInput(t.type)?setValidInputField(t,e,n):setValidToggleField(t,e,n)}))}function onElementInput(t,e,n,i){setValidInputField(t,e,n),i.dispatchEvent(new Event("enable-button"))}function onElementChange(t,e,n,i){setValidToggleField(t,e,n),i.dispatchEvent(new Event("enable-button"))}export{initValidation};